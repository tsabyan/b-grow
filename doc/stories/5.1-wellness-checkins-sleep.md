# <!-- Powered by BMADâ„¢ Core -->

# Story 5.1: Wellness Module - Daily Check-ins & Sleep Tracking

## Status
**PENDING** ðŸ”„

## Story
**As a** user,
**I want** to track my daily mood, energy, stress levels, sleep, and calculate my wellness score,
**so that** I can monitor my overall well-being and identify patterns affecting my health.

## Acceptance Criteria
1. User can submit daily check-in with mood, energy, stress (1-10 scale), steps, and water intake
2. User can log sleep with bedtime, wake time, duration, and quality rating
3. User can add gratitude journal entries and daily notes
4. System automatically calculates daily wellness score (0-100) based on weighted components
5. User can view wellness score breakdown showing contribution of each factor
6. User can view wellness trend chart over time (7-day, 30-day)
7. User receives +15 points for completing daily check-in
8. All wellness data protected by RLS policies

## Tasks / Subtasks
- [ ] Database Schema (AC: 8)
  - [ ] Create daily_checkins table (mood, energy, stress, steps, water_intake, exercise_minutes, gratitude, notes)
  - [ ] Create sleep_logs table (sleep_date, bedtime, wake_time, duration, quality, interruptions)
  - [ ] Create mood_logs table (for detailed mood tracking)
  - [ ] Create meditation_sessions table (duration, type)
  - [ ] Create wellness_scores table (total_score, component breakdowns)
  - [ ] Enable RLS on all wellness tables
  - [ ] Create UNIQUE constraints (user_id, date)
- [ ] Wellness Service (AC: 4, 5)
  - [ ] Create WellnessService in services/wellness/
  - [ ] Implement calculateWellnessScore() with weighted algorithm
  - [ ] Sleep: 25%, Mood: 20%, Stress: 15%, Activity: 20%, Hydration: 10%, Habits: 10%
  - [ ] Implement getScoreBreakdown() for visualization
  - [ ] Implement getTrend() for historical analysis
- [ ] Check-in Service (AC: 1, 7)
  - [ ] Create CheckinService in services/wellness/
  - [ ] Implement submitDailyCheckin() with validation
  - [ ] Award +15 points for daily check-in completion
  - [ ] Prevent duplicate check-ins for same day
- [ ] Sleep Service (AC: 2)
  - [ ] Create SleepService in services/wellness/
  - [ ] Implement logSleep() with duration auto-calculation
  - [ ] Implement calculateSleepScore() for wellness score
  - [ ] Implement getSleepPattern() for trend analysis
- [ ] Server Actions (AC: 1, 2)
  - [ ] Create actions/wellness.ts
  - [ ] Implement submitCheckin server action
  - [ ] Implement logSleep server action
  - [ ] Implement logMood server action
  - [ ] Implement getWellnessScore server action
- [ ] Check-in Components (AC: 1, 3)
  - [ ] Create DailyCheckin form component
  - [ ] Create MoodPicker (1-10 slider with emoji)
  - [ ] Create EnergySlider (1-10)
  - [ ] Create StressSlider (1-10, inverted for score)
  - [ ] Create WaterIntake counter (glasses)
  - [ ] Create GratitudeJournal textarea
- [ ] Sleep Components (AC: 2)
  - [ ] Create SleepLog form (bedtime, wake time pickers)
  - [ ] Create SleepChart showing duration over time
  - [ ] Create SleepStats (avg. duration, quality)
- [ ] Wellness Score Components (AC: 4, 5, 6)
  - [ ] Create WellnessScore circular progress display
  - [ ] Create WellnessBreakdown radial chart (Recharts)
  - [ ] Create WellnessTrend line chart
  - [ ] Add score color coding (red <50, yellow 50-75, green >75)
- [ ] Wellness Page (AC: 1, 2, 4, 5, 6)
  - [ ] Create app/(dashboard)/wellness/page.tsx
  - [ ] Display today's wellness score prominently
  - [ ] Show daily check-in form if not completed today
  - [ ] Display score breakdown and trend
  - [ ] Create app/(dashboard)/wellness/sleep/page.tsx
  - [ ] Create app/(dashboard)/wellness/mood/page.tsx

## Dev Notes

### Previous Story Insights
**From Story 4.1**: Multi-component calculations working (BMI, macros), Recharts integration successful, UNIQUE date constraints effective.

### Data Models
**Wellness Schema** [Source: database.md]:
```sql
daily_checkins:
  - id, user_id, checkin_date
  - mood, energy, stress (1-10)
  - steps, water_intake, exercise_minutes
  - gratitude, notes
  - UNIQUE(user_id, checkin_date)

sleep_logs:
  - id, user_id, sleep_date
  - bedtime, wake_time (TIMESTAMPTZ)
  - duration_hours (DECIMAL)
  - quality (1-10)
  - interruptions, dream_recall, notes
  - UNIQUE(user_id, sleep_date)

wellness_scores:
  - id, user_id, score_date
  - total_score (0-100)
  - sleep_score, mood_score, stress_score
  - activity_score, hydration_score, habits_score
  - UNIQUE(user_id, score_date)
```

### Tech Stack Specifications
**Wellness Score Algorithm** [Source: backend.md]:
```
Total Score (0-100) =
  Sleep (25%) + Mood (20%) + Stress (15%, inverted) +
  Activity (20%) + Hydration (10%) + Habits (10%)

Components:
- Sleep: (duration/8 * 50) + (quality * 5)
- Mood: mood_rating * 2 * 0.20
- Stress: (10 - stress_rating) * 2 * 0.15
- Activity: (steps/10000 * 100 + exercise_min/30 * 100)/2 * 0.20
- Hydration: (water_intake/8) * 100 * 0.10
- Habits: (completion_rate) * 100 * 0.10
```

### File Locations
**Wellness Files** [Source: backend.md, frontend.md]:
- **Schema**: lib/db/schema/wellness.ts
- **Services**: services/wellness/wellness.service.ts, services/wellness/checkin.service.ts, services/wellness/sleep.service.ts
- **Actions**: actions/wellness.ts
- **Components**: components/wellness/ (daily-checkin, mood-picker, sleep-log, wellness-score, wellness-breakdown)
- **Pages**: app/(dashboard)/wellness/, app/(dashboard)/wellness/sleep/
- **Validation**: lib/validations/wellness.ts

### Infrastructure Requirements
- UNIQUE constraints prevent duplicate entries per day
- Wellness score calculated daily at midnight or on-demand
- Cross-module integration with HabitService for habits completion rate
- Date-based queries optimized with indexes

### Testing Requirements
- [ ] Test wellness score calculation accuracy
- [ ] Test all components weighted correctly (sum to 100%)
- [ ] Test cannot submit multiple check-ins per day
- [ ] Test sleep duration auto-calculation
- [ ] Test score trend chart renders correctly
- [ ] Test points awarded for daily check-in
- [ ] Test RLS policies

### Technical Constraints
- **Performance**: Wellness score calculation should be <100ms
- **UX**: Daily check-in should be completable in <2 minutes
- **Data Integrity**: One check-in/sleep log per day per user
- **Cross-Module**: Integrates with Habit completion data

## Testing
- [ ] Unit tests for wellness score algorithm
- [ ] Unit tests for each component score calculation
- [ ] Integration tests for daily check-in CRUD
- [ ] E2E test for complete daily routine (check-in â†’ sleep â†’ view score)
- [ ] Test score recalculation when habit data changes

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-07 | 1.0 | Initial story creation | Dev Team |

## Dev Agent Record
*This section will be populated by the implementing agent*

## QA Results
*This section will be populated by the QA agent after implementation review*
