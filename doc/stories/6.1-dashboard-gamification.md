# <!-- Powered by BMADâ„¢ Core -->

# Story 6.1: Dashboard & Gamification System

## Status
**PENDING** ðŸ”„

## Story
**As a** user,
**I want** to view a unified dashboard with all my progress and earn points/achievements for my activities,
**so that** I stay motivated and can see my holistic self-improvement journey at a glance.

## Acceptance Criteria
1. Dashboard displays wellness score, habit streak, financial balance, and weight progress
2. User can complete quick actions from dashboard (log habit, add transaction, log weight)
3. Points system awards points for all activities (habits, transactions, workouts, check-ins)
4. Level system automatically progresses user through 7 levels (Beginner â†’ Legend)
5. Achievement system unlocks badges for milestones (30-day streak, budget adherence, etc.)
6. User can view all earned and available achievements
7. Dashboard shows today's recommended actions based on user patterns
8. Cross-module insights suggest correlations (e.g., "Sleep better after exercise")

## Tasks / Subtasks
- [ ] Database Schema (AC: 5)
  - [ ] Create achievements table with requirements and rewards
  - [ ] Create achievements_earned table tracking unlocks
  - [ ] Seed default achievements from PRD
  - [ ] Enable RLS on achievement tables
- [ ] Points Service (AC: 3, 4)
  - [ ] Create PointsService in services/gamification/
  - [ ] Define POINT_VALUES constants (+10 habit, +5 transaction, +25 workout, +15 checkin)
  - [ ] Implement awardPoints() updating user profile
  - [ ] Implement checkLevelUp() with 7 level thresholds
  - [ ] Send notification on level up
- [ ] Achievement Service (AC: 5, 6)
  - [ ] Create AchievementService in services/gamification/
  - [ ] Implement checkAchievements() triggered after actions
  - [ ] Implement unlockAchievement() with celebration
  - [ ] Implement getProgress() for available achievements
  - [ ] Pre-define achievements: First Steps, Habit Hero, Money Master, Weight Warrior, Zen Master
- [ ] Insights Service (AC: 8)
  - [ ] Create CorrelationService in services/insights/
  - [ ] Implement detectCorrelations() analyzing cross-module data
  - [ ] Example: Sleep quality vs. exercise days
  - [ ] Example: Spending vs. stress levels
  - [ ] Implement getRecommendations() suggesting actions
- [ ] Server Actions (AC: 2, 3, 5)
  - [ ] Update all module actions to call PointsService
  - [ ] Update all module actions to call AchievementService
  - [ ] Create actions/gamification.ts for manual checks
  - [ ] Create actions/insights.ts for correlation queries
- [ ] Dashboard Components (AC: 1, 2)
  - [ ] Create StatsCards showing key metrics from each module
  - [ ] Create QuickActions FAB with multi-modal options
  - [ ] Create TodayHabits widget with quick-complete
  - [ ] Create RecentTransactions widget
  - [ ] Create WellnessScoreWidget
  - [ ] Create WeightTrendMini chart
- [ ] Gamification Components (AC: 3, 4, 5, 6)
  - [ ] Create PointsDisplay showing total points
  - [ ] Create LevelBadge with current level
  - [ ] Create ProgressBar for XP to next level
  - [ ] Create AchievementCard with icon and description
  - [ ] Create AchievementModal for unlock celebration
  - [ ] Create AchievementGrid showing all achievements
- [ ] Insights Components (AC: 8)
  - [ ] Create InsightCard displaying correlation
  - [ ] Create RecommendationList with actionable tips
  - [ ] Create CorrelationChart visualizing relationship
- [ ] Dashboard Page (AC: 1, 2, 7, 8)
  - [ ] Create app/(dashboard)/page.tsx (main dashboard)
  - [ ] Aggregate data from all modules server-side
  - [ ] Display wellness score prominently at top
  - [ ] Show quick stats cards (habits, balance, weight)
  - [ ] Show today's recommended actions
  - [ ] Create app/(dashboard)/insights/page.tsx
  - [ ] Create app/(dashboard)/achievements/page.tsx

## Dev Notes

### Previous Story Insights
**From Story 5.1**: Wellness score calculation working, cross-module data integration feasible, weighted scoring patterns established.

### Data Models
**Gamification Schema** [Source: database.md]:
```sql
profiles (gamification fields):
  - total_points (INTEGER)
  - current_level (TEXT)

achievements:
  - id, name, description, icon, category
  - requirement_type ('streak'|'total'|'consecutive')
  - requirement_value
  - points, badge_tier

achievements_earned:
  - id, user_id, achievement_id
  - earned_at
  - UNIQUE(user_id, achievement_id)
```

**Dashboard Aggregation** [Source: database.md]:
```sql
user_dashboard_summary VIEW:
  - active_habits, today_completed
  - monthly_income, monthly_expense
  - current_weight, wellness_score
  - total_points, current_level
```

### Tech Stack Specifications
**Gamification System** [Source: backend.md, PRD.md]:
- **Points**: Habit +10, Streak 7-day +50, Streak 30-day +200, Transaction +5, Budget met +100, Weight +10, Workout +25, Checkin +15
- **Levels**: Beginner (0), Novice (501), Intermediate (2001), Advanced (5001), Expert (10001), Master (25001), Legend (50001+)
- **Achievements**: First Steps, Habit Hero, Money Master, Weight Warrior, Zen Master, Sleep Champion, Life Legend

### File Locations
**Dashboard & Gamification Files** [Source: backend.md, frontend.md]:
- **Services**: services/gamification/points.service.ts, services/gamification/achievement.service.ts, services/insights/correlation.service.ts
- **Components**: components/dashboard/ (stats-cards, quick-actions, today-habits), components/gamification/ (points-display, achievement-card)
- **Pages**: app/(dashboard)/page.tsx, app/(dashboard)/achievements/, app/(dashboard)/insights/
- **Constants**: lib/constants/achievements.ts

### Infrastructure Requirements
- Database view for efficient dashboard queries
- Real-time updates for points/level changes
- Achievement unlock triggers after relevant actions
- Correlation analysis runs periodically (daily batch job)

### Testing Requirements
- [ ] Test points awarded correctly for all actions
- [ ] Test level progression at thresholds
- [ ] Test achievement unlock triggers
- [ ] Test cannot unlock same achievement twice
- [ ] Test dashboard aggregates data from all modules
- [ ] Test quick actions work from dashboard
- [ ] Test correlations detected accurately

### Technical Constraints
- **Performance**: Dashboard should load all data <1 second
- **UX**: Achievement unlock should celebrate with animation
- **Data**: Dashboard view optimized for single query
- **Insights**: Correlations require minimum 14 days of data

## Testing
- [ ] Unit tests for points calculation
- [ ] Unit tests for level progression logic
- [ ] Unit tests for achievement unlock conditions
- [ ] Integration tests for cross-module data aggregation
- [ ] E2E test for complete user journey with gamification
- [ ] Visual tests for achievement unlock celebration

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-07 | 1.0 | Initial story creation | Dev Team |

## Dev Agent Record
*This section will be populated by the implementing agent*

## QA Results
*This section will be populated by the QA agent after implementation review*
